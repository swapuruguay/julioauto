<div class="row">
  <div class="col col-sm-12">
    <h1>{{titulo}}</h1>

    <form id="acumulado" class="form-inline">
      <label for="mes">Mes</label>
      <input type="text" name="mes" id="mes" class="form-control">
      <label for="anio">AÃ±o</label>
      <input type="text" id="anio" name="anio" class="form-control">
      <input type="submit" value="Buscar" class="btn btn-info">
    </form>
    <p>&nbsp;</p>
    <div id="resultado"></div>
    
  </div>
</div>
<script>
  let frm = document.getElementById('acumulado')
  frm.addEventListener('submit', async evt => {
    evt.preventDefault()
    const datos = {mes: frm.mes.value, anio: frm.anio.value}
    let res = await fetch('/ventas/acumula', {
      method: 'post',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(datos)
    })
    const respuesta = await res.json()
    let html = `<table class="table table-condensed table-striped">
                <tr>
                <th>Sucursal</th>
                <th>Cantidad</th>
                <th>Nuevos</th>
                <th>Usados</th>
                <tr>
            `
    let cantidad = 0
    let cantidadU = 0
    respuesta.listado.forEach(r => {
      html+= `<tr><td>${r.nombre}</td><td>${r.nuevos+r.usados}</td><td>${r.nuevos}</td><td>${r.usados}</td></tr>`
      cantidad+= r.nuevos
      cantidadU+= r.usados
      return r
    })
    html+= `<tr><td><strong>Total</strong></td><td><strong>${cantidad+cantidadU}</strong></td><td><strong>${cantidad}</strong></td><td><strong>${cantidadU}</strong></td></tr>`
    html+= '</table>'
    const divResultado = document.getElementById('resultado')
    divResultado.innerHTML = html
  })
</script>
